<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TrustTree</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .dashboard-nav {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .profile-section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }
        .stats-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .emergency-alert {
            background-color: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .request-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .feedback-section {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        .feedback-item {
            border-left: 4px solid #4CAF50;
            padding: 20px;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .feedback-item:hover {
            transform: translateY(-2px);
        }
        .feedback-item.new {
            animation: fadeInDown 0.5s ease-out;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .feedback-filters {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .rating-input i {
            cursor: pointer;
            font-size: 24px;
            color: #ddd;
            transition: color 0.2s;
        }
        .rating-input i.active {
            color: #ffd700;
        }
        .feedback-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-right: 8px;
            background: #e9ecef;
        }
        .feedback-stats {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav-link {
            position: relative;
            padding: 0.8rem 1rem;
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #0d6efd;
        }
        .nav-link.active {
            color: #0d6efd;
            font-weight: 500;
        }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #0d6efd;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .analytics-chart {
            height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .contribution-type {
            padding: 10px;
            border-left: 3px solid #4CAF50;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }
        .badge-achievement {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin: 5px;
        }
        .feedback-response {
            margin-left: 40px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }
        .feedback-media {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .feedback-media img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }
        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            padding: 8px 0;
        }
        .brand-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 8px;
        }
        .brand-logo {
            width: 150px;
            height: 120px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 4px;
        }
        .brand-text {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.5px;
            line-height: 1;
            margin: 0;
        }
        .brand-text .text-primary {
            color: #4CAF50 !important;
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light dashboard-nav">
    <div class="container">
        <a class="navbar-brand" href="dashboard.html">
            <div class="brand-container">
                <img src="logo (2).jpg" 
                     alt="TrustTree Logo" 
                     class="brand-logo">
                <p class="brand-text">
                    <span class="text-primary">Trust</span>Tree
                </p>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="#help-requests">
                        <i class="fas fa-hands-helping me-1"></i> Help Requests
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#offers">
                        <i class="fas fa-gift me-1"></i> My Offers
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#feedback">
                        <i class="fas fa-star me-1"></i> Feedback
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#buy-sell">
                        <i class="fas fa-store me-1"></i> Buy & Sell
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                        John Doe
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#profile">Profile</a></li>
                        <li><a class="dropdown-item" href="#settings">Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="index.html">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-4">
    <!-- Emergency Alert -->
    <div class="emergency-alert">
        <h5><i class="fas fa-exclamation-triangle"></i> Emergency Help Needed!</h5>
        <p class="mb-0">Medical assistance needed at 123 Community St. Click for details.</p>
    </div>

    <div class="row">
        <!-- Left Column - Profile and Stats -->
        <div class="col-md-4">
            <!-- Profile Section -->
            <div class="profile-section text-center">
                <img src="/api/placeholder/100/100" alt="Profile" class="profile-image mb-3">
                <h4>John Doe</h4>
                <p class="text-muted">Member since January 2024</p>
                <div class="d-grid gap-2">
                    <button class="btn btn-primary">Edit Profile</button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-card">
                <h5>Your Impact</h5>
                <div class="row text-center">
                    <div class="col-4">
                        <h3>15</h3>
                        <small>Helped</small>
                    </div>
                    <div class="col-4">
                        <h3>4.8</h3>
                        <small>Rating</small>
                    </div>
                    <div class="col-4">
                        <h3>20</h3>
                        <small>Points</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Main Content -->
        <div class="col-md-8">
            <!-- Help Requests Section -->
            <div id="help-requests" class="section active">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Help Requests</h5>
                        <button class="btn btn-primary btn-sm" onclick="showNewRequestModal()">New Request</button>
                    </div>
                    <div class="card-body">
                        <div class="request-card">
                            <div class="d-flex justify-content-between">
                                <h6>Grocery Shopping Assistance</h6>
                                <span class="badge bg-warning">Pending</span>
                            </div>
                            <p class="mb-2">Need help with grocery shopping for elderly neighbor</p>
                            <small class="text-muted">Posted 2 hours ago</small>
                        </div>

                        <div class="request-card">
                            <div class="d-flex justify-content-between">
                                <h6>Moving Help</h6>
                                <span class="badge bg-success">Active</span>
                            </div>
                            <p class="mb-2">Need assistance moving furniture this weekend</p>
                            <small class="text-muted">Posted 1 day ago</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Offers Section -->
            <div id="offers" class="section">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">My Active Offers</h5>
                    </div>
                    <div class="card-body">
                        <div class="request-card">
                            <div class="d-flex justify-content-between">
                                <h6>Grocery Shopping Help</h6>
                                <span class="badge bg-primary">Offering</span>
                            </div>
                            <p class="mb-2">Available to help with grocery shopping on weekends</p>
                            <small class="text-muted">Posted 1 day ago</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback Section -->
            <div id="feedback" class="section">
                <div class="card feedback-section mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Community Feedback & Impact</h5>
                    </div>

                    <!-- Enhanced Feedback Stats -->
                    <div class="feedback-stats">
                        <div>
                            <h3>4.8</h3>
                            <small class="text-muted">Average Rating</small>
                        </div>
                        <div>
                            <h3>127</h3>
                            <small class="text-muted">Total Reviews</small>
                        </div>
                        <div>
                            <h3>95%</h3>
                            <small class="text-muted">Positive</small>
                        </div>
                        <div>
                            <h3>50+</h3>
                            <small class="text-muted">Helped</small>
                            <span class="badge-achievement">
                                <i class="fas fa-award"></i> Top Helper
                            </span>
                        </div>
                    </div>

                    <!-- Analytics Chart -->
                    <div class="analytics-chart">
                        <canvas id="feedbackTrend"></canvas>
                    </div>

                    <!-- Contribution Breakdown -->
                    <div class="px-3">
                        <h6 class="mb-3">Contribution Breakdown</h6>
                        <div class="contribution-type">
                            <div class="d-flex justify-content-between">
                                <span>Moving Assistance</span>
                                <span>32 times</span>
                            </div>
                            <div class="progress mt-2" style="height: 5px;">
                                <div class="progress-bar" style="width: 65%"></div>
                            </div>
                        </div>
                        <div class="contribution-type">
                            <div class="d-flex justify-content-between">
                                <span>Shopping Help</span>
                                <span>28 times</span>
                            </div>
                            <div class="progress mt-2" style="height: 5px;">
                                <div class="progress-bar" style="width: 55%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Filters -->
                    <div class="feedback-filters">
                        <div class="row align-items-center g-2">
                            <div class="col-md-3">
                                <select class="form-select form-select-sm" id="categoryFilter">
                                    <option>All Categories</option>
                                    <option>Moving Help</option>
                                    <option>Shopping</option>
                                    <option>Medical</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select form-select-sm" id="ratingFilter">
                                    <option>All Ratings</option>
                                    <option>5 Stars</option>
                                    <option>4+ Stars</option>
                                    <option>3+ Stars</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select form-select-sm" id="sortBy">
                                    <option>Most Recent</option>
                                    <option>Highest Rated</option>
                                    <option>Most Helpful</option>
                                </select>
                            </div>
                            <div class="col-md-3 text-end">
                                <button class="btn btn-primary btn-sm" onclick="showFeedbackModal()">
                                    <i class="fas fa-plus"></i> Write Feedback
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Updated Feedback Items -->
                    <div class="card-body">
                        <div class="feedback-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah" 
                                             alt="Sarah M." class="rounded-circle" width="40" height="40">
                                        <div>
                                            <h6 class="mb-0">Sarah M.</h6>
                                            <span class="feedback-category">Help Request</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-warning">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                </div>
                            </div>
                            <p class="mt-3 mb-1">John was incredibly helpful and kind! He helped me move furniture 
                            efficiently and carefully. Would definitely recommend!</p>
                            <div class="feedback-media">
                                <img src="https://picsum.photos/80" alt="Feedback photo">
                                <img src="https://picsum.photos/81" alt="Feedback photo">
                            </div>
                            <div class="feedback-response">
                                <div class="d-flex align-items-center gap-2">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" 
                                         alt="John D." class="rounded-circle" width="30" height="30">
                                    <small><strong>John D.</strong> responded:</small>
                                </div>
                                <p class="mb-0 mt-2">Thank you for your kind words! It was a pleasure helping you.</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <small class="text-muted">2 days ago</small>
                                <div>
                                    <button class="btn btn-sm btn-light" onclick="toggleHelpful(this)" title="Helpful">
                                        <i class="far fa-thumbs-up"></i> 12
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="addFeedbackResponse(this.closest('.feedback-item'))" title="Respond">
                                        <i class="far fa-comment"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="feedback-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Mike" 
                                             alt="Mike R." class="rounded-circle" width="40" height="40">
                                        <div>
                                            <h6 class="mb-0">Mike R.</h6>
                                            <span class="feedback-category">Shopping</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-warning">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                </div>
                            </div>
                            <p class="mt-3 mb-1">Great experience with the grocery shopping assistance. Very prompt and careful 
                            with my shopping list. Will use the service again!</p>
                            <div class="feedback-media">
                                <img src="https://picsum.photos/82" alt="Feedback photo">
                                <img src="https://picsum.photos/83" alt="Feedback photo">
                            </div>
                            <div class="feedback-response">
                                <div class="d-flex align-items-center gap-2">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" 
                                         alt="John D." class="rounded-circle" width="30" height="30">
                                    <small><strong>John D.</strong> responded:</small>
                                </div>
                                <p class="mb-0 mt-2">Thank you for your feedback! I'm glad I could assist.</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <small class="text-muted">1 week ago</small>
                                <div>
                                    <button class="btn btn-sm btn-light" onclick="toggleHelpful(this)" title="Helpful">
                                        <i class="far fa-thumbs-up"></i> 8
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="addFeedbackResponse(this.closest('.feedback-item'))" title="Respond">
                                        <i class="far fa-comment"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buy & Sell Section -->
            <div id="buy-sell" class="section">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Community Marketplace</h5>
                        <button class="btn btn-primary btn-sm">Add Listing</button>
                    </div>
                    <div class="card-body">
                        <div class="request-card">
                            <div class="d-flex justify-content-between">
                                <h6>Used Furniture</h6>
                                <span class="badge bg-success">For Sale</span>
                            </div>
                            <p class="mb-2">Good condition sofa set available</p>
                            <small class="text-muted">$200 - Posted 3 days ago</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Request Modal -->
<div class="modal fade" id="newRequestModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Help Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newRequestForm">
                    <div class="mb-3">
                        <label for="requestTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="requestTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="requestDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="requestDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="requestCategory" class="form-label">Category</label>
                        <select class="form-select" id="requestCategory" required>
                            <option value="">Select a category</option>
                            <option value="shopping">Shopping</option>
                            <option value="transportation">Transportation</option>
                            <option value="housework">Housework</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="requestUrgency" class="form-label">Urgency</label>
                        <select class="form-select" id="requestUrgency" required>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="emergency">Emergency</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitRequest()">Create Request</button>
            </div>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Write Feedback</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm">
                    <div class="mb-3">
                        <label class="form-label">Rating</label>
                        <div class="rating-input">
                            <i class="far fa-star" data-rating="1"></i>
                            <i class="far fa-star" data-rating="2"></i>
                            <i class="far fa-star" data-rating="3"></i>
                            <i class="far fa-star" data-rating="4"></i>
                            <i class="far fa-star" data-rating="5"></i>
                        </div>
                        <input type="hidden" id="ratingInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="feedbackCategory" class="form-label">Category</label>
                        <select class="form-select" id="feedbackCategory" required>
                            <option value="">Select category</option>
                            <option value="moving">Moving Help</option>
                            <option value="shopping">Shopping</option>
                            <option value="medical">Medical</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="feedbackText" class="form-label">Your Feedback</label>
                        <textarea class="form-control" id="feedbackText" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Add Photos</label>
                        <input type="file" class="form-control" id="feedbackPhotos" multiple accept="image/*">
                        <div id="photoPreview" class="feedback-media mt-2"></div>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="anonymousFeedback">
                        <label class="form-check-label" for="anonymousFeedback">
                            Submit Anonymously
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitFeedback()">Submit Feedback</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function showNewRequestModal() {
    const modal = new bootstrap.Modal(document.getElementById('newRequestModal'));
    modal.show();
}

function submitRequest() {
    const title = document.getElementById('requestTitle').value;
    const description = document.getElementById('requestDescription').value;
    const category = document.getElementById('requestCategory').value;
    const urgency = document.getElementById('requestUrgency').value;

    // Add your request submission logic here
    console.log('New request:', { title, description, category, urgency });

    // Close modal and show success message
    const modal = bootstrap.Modal.getInstance(document.getElementById('newRequestModal'));
    modal.hide();
    alert('Request created successfully!');
    document.getElementById('newRequestForm').reset();
}

// Add this if you want to handle the emergency alert clicks
document.querySelector('.emergency-alert').addEventListener('click', function() {
    alert('Emergency details: Medical assistance needed at 123 Community St. Please contact emergency services if you can help.');
});

document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = link.getAttribute('href').substring(1);
        
        // Update active states
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        
        link.classList.add('active');
        document.getElementById(target).classList.add('active');
    });
});

function showFeedbackModal() {
    const modal = new bootstrap.Modal(document.getElementById('feedbackModal'));
    modal.show();
}

// Initialize feedback trend chart
function initFeedbackChart() {
    const ctx = document.getElementById('feedbackTrend').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Average Rating',
                data: [4.5, 4.6, 4.7, 4.8, 4.8, 4.9],
                borderColor: '#4CAF50',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    min: 4,
                    max: 5
                }
            }
        }
    });
}

// Initialize chart when page loads
document.addEventListener('DOMContentLoaded', function() {
    initFeedbackChart();
    initRatingInput();
    handlePhotoPreview();
});

// Add filter functionality
document.querySelectorAll('.feedback-filters select').forEach(select => {
    select.addEventListener('change', filterFeedback);
});

function initRatingInput() {
    const stars = document.querySelectorAll('.rating-input i');
    stars.forEach(star => {
        star.addEventListener('mouseover', function() {
            const rating = this.dataset.rating;
            updateStars(rating, 'hover');
        });
        
        star.addEventListener('mouseout', function() {
            const currentRating = document.getElementById('ratingInput').value;
            updateStars(currentRating, 'selected');
        });
        
        star.addEventListener('click', function() {
            const rating = this.dataset.rating;
            document.getElementById('ratingInput').value = rating;
            updateStars(rating, 'selected');
        });
    });
}

function updateStars(rating, mode) {
    const stars = document.querySelectorAll('.rating-input i');
    stars.forEach(star => {
        const value = star.dataset.rating;
        if (mode === 'hover') {
            star.className = value <= rating ? 'fas fa-star text-warning' : 'far fa-star';
        } else if (mode === 'selected') {
            star.className = value <= rating ? 'fas fa-star text-warning' : 'far fa-star';
        }
    });
}

function handlePhotoPreview() {
    const input = document.getElementById('feedbackPhotos');
    const preview = document.getElementById('photoPreview');
    
    input.addEventListener('change', function() {
        preview.innerHTML = '';
        for (const file of this.files) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.onload = () => URL.revokeObjectURL(img.src);
            preview.appendChild(img);
        }
    });
}

function createFeedbackElement(data) {
    const template = `
        <div class="feedback-item new" data-date="${new Date().toISOString()}" data-helpful="0">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="d-flex align-items-center gap-2">
                        <img src="${data.anonymous ? 'https://api.dicebear.com/7.x/avataaars/svg?seed=anonymous' : 'https://api.dicebear.com/7.x/avataaars/svg?seed=John'}" 
                             alt="User" class="rounded-circle" width="40" height="40">
                        <div>
                            <h6 class="mb-0">${data.anonymous ? 'Anonymous' : 'John Doe'}</h6>
                            <span class="feedback-category">${data.category}</span>
                        </div>
                    </div>
                </div>
                <div class="text-warning">
                    ${Array(5).fill(0).map((_, i) => 
                        `<i class="fa${i < data.rating ? 's' : 'r'} fa-star"></i>`
                    ).join('')}
                </div>
            </div>
            <p class="mt-3 mb-1">${data.text}</p>
            ${data.photos.length ? `
                <div class="feedback-media">
                    ${Array.from(data.photos).map(photo => `
                        <img src="${URL.createObjectURL(photo)}" alt="Feedback photo">
                    `).join('')}
                </div>
            ` : ''}
            <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="text-muted">Just now</small>
                <div>
                    <button class="btn btn-sm btn-light" onclick="toggleHelpful(this)" title="Helpful">
                        <i class="far fa-thumbs-up"></i> 0
                    </button>
                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="addFeedbackResponse(this.closest('.feedback-item'))" title="Respond">
                        <i class="far fa-comment"></i>
                    </button>
                </div>
            </div>
        </div>
    `;
    return template;
}

function submitFeedback() {
    const rating = document.getElementById('ratingInput').value;
    const category = document.getElementById('feedbackCategory').value;
    const text = document.getElementById('feedbackText').value;
    const anonymous = document.getElementById('anonymousFeedback').checked;
    const photos = document.getElementById('feedbackPhotos').files;

    if (!rating || !category || !text) {
        alert('Please fill in all required fields');
        return;
    }

    const feedbackData = { rating, category, text, anonymous, photos };
    
    // Add new feedback to the top of the list
    const feedbackContainer = document.querySelector('#feedback .card-body');
    feedbackContainer.insertAdjacentHTML('afterbegin', createFeedbackElement(feedbackData));

    // Update feedback stats
    const totalReviews = document.querySelector('.feedback-stats div:nth-child(2) h3');
    totalReviews.textContent = parseInt(totalReviews.textContent) + 1;

    // Close modal and reset form
    const modal = bootstrap.Modal.getInstance(document.getElementById('feedbackModal'));
    modal.hide();
    document.getElementById('feedbackForm').reset();
    document.getElementById('photoPreview').innerHTML = '';
    updateStars(0, 'selected');

    // Remove new animation class after animation completes
    setTimeout(() => {
        const newFeedback = feedbackContainer.querySelector('.feedback-item.new');
        if (newFeedback) {
            newFeedback.classList.remove('new');
        }
    }, 500);
}

// Filter feedback items based on selected criteria
function filterFeedback() {
    const category = document.getElementById('categoryFilter').value;
    const rating = document.getElementById('ratingFilter').value;
    const sort = document.getElementById('sortBy').value;
    const feedbackItems = document.querySelectorAll('.feedback-item');
    
    feedbackItems.forEach(item => {
        const itemCategory = item.querySelector('.feedback-category').textContent;
        const itemRating = item.querySelectorAll('.fas.fa-star').length;
        let show = true;

        // Category filter
        if (category !== 'All Categories' && itemCategory !== category) {
            show = false;
        }

        // Rating filter
        if (rating === '5 Stars' && itemRating < 5) show = false;
        if (rating === '4+ Stars' && itemRating < 4) show = false;
        if (rating === '3+ Stars' && itemRating < 3) show = false;

        item.style.display = show ? 'block' : 'none';
    });

    // Sort implementation
    const container = document.querySelector('#feedback .card-body');
    const items = Array.from(feedbackItems);
    
    items.sort((a, b) => {
        if (sort === 'Most Recent') {
            return new Date(b.dataset.date) - new Date(a.dataset.date);
        } else if (sort === 'Highest Rated') {
            return b.querySelectorAll('.fas.fa-star').length - a.querySelectorAll('.fas.fa-star').length;
        } else if (sort === 'Most Helpful') {
            return parseInt(b.dataset.helpful) - parseInt(a.dataset.helpful);
        }
    });

    items.forEach(item => container.appendChild(item));
}

// Toggle helpful button and update count
function toggleHelpful(button) {
    const isActive = button.classList.contains('active');
    const countElement = button.querySelector('i').nextSibling;
    let count = parseInt(countElement.textContent);
    
    if (isActive) {
        button.classList.remove('active', 'btn-primary');
        button.classList.add('btn-light');
        count--;
    } else {
        button.classList.add('active', 'btn-primary');
        button.classList.remove('btn-light');
        count++;
    }
    
    countElement.textContent = ` ${count}`;
    button.closest('.feedback-item').dataset.helpful = count;
    updateFeedbackStats();
}

// Add feedback response
function addFeedbackResponse(feedbackItem) {
    const responseText = prompt('Enter your response:');
    if (responseText) {
        const response = `
            <div class="feedback-response">
                <div class="d-flex align-items-center gap-2">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=John" 
                         alt="John D." class="rounded-circle" width="30" height="30">
                    <small><strong>John D.</strong> responded:</small>
                </div>
                <p class="mb-0 mt-2">${responseText}</p>
            </div>
        `;
        feedbackItem.insertAdjacentHTML('beforeend', response);
    }
}

// Update feedback statistics
function updateFeedbackStats() {
    const feedbackItems = document.querySelectorAll('.feedback-item');
    const stats = {
        total: feedbackItems.length,
        average: 0,
        positive: 0
    };

    let totalRating = 0;
    feedbackItems.forEach(item => {
        const rating = item.querySelectorAll('.fas.fa-star').length;
        totalRating += rating;
        if (rating >= 4) stats.positive++;
    });

    stats.average = (totalRating / stats.total).toFixed(1);
    const positivePercentage = Math.round((stats.positive / stats.total) * 100);

    // Update stats display
    document.querySelector('.feedback-stats div:nth-child(1) h3').textContent = stats.average;
    document.querySelector('.feedback-stats div:nth-child(2) h3').textContent = stats.total;
    document.querySelector('.feedback-stats div:nth-child(3) h3').textContent = positivePercentage + '%';
}

// Update event listeners
document.addEventListener('DOMContentLoaded', function() {
    // ...existing initialization code...
    
    // Add filter change listeners
    document.querySelectorAll('.feedback-filters select').forEach(select => {
        select.addEventListener('change', filterFeedback);
    });

    // Initialize feedback stats
    updateFeedbackStats();

    // Add data attributes to existing feedback items
    document.querySelectorAll('.feedback-item').forEach((item, index) => {
        const date = new Date();
        date.setDate(date.getDate() - index); // Stagger dates for existing items
        item.dataset.date = date.toISOString();
        item.dataset.helpful = item.querySelector('.fa-thumbs-up').nextSibling.textContent.trim();
    });
});
</script>

</body>
</html>
